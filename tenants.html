<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenants – My Tenant Manager</title>
    <!-- External CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- Hide page until auth check -->
    <style>html { visibility: hidden; opacity: 0; }</style>
    <!-- Auth Gate -->
    <script type="module">
        import { supabase } from "./scripts/supabase.js";
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) {
            window.location.replace("/login.html");
        } else {
            document.documentElement.style.visibility = "visible";
            document.documentElement.style.opacity = "1";
        }
    </script>
</head>
<body>
    <!-- Mobile Header -->
    <div class="mobile-header">
        <strong>My Tenant Manager</strong>
        <button class="menu-btn" id="openMenu">☰ Menu</button>
    </div>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-content">
            <button class="mobile-menu-close" id="closeMenu">×</button>
            <div class="nav-group">
                <a class="nav-link" href="/index.html">Dashboard</a>
                <a class="nav-link active" href="/tenants.html">Tenants</a>
                <a class="nav-link" href="/rent.html">Rent</a>
                <a class="nav-link" href="/utilities.html">Utilities</a>
                <a class="nav-link" href="/payments.html">Payments</a>
                <a class="nav-link" href="/ledger.html">General Ledger</a>
                <a class="nav-link" href="/tenant-ledger.html">Tenant Ledger</a>
                <a class="nav-link" href="/profile.html">My Profile</a>
            </div>
            <div class="nav-group">
                <a class="nav-link" href="/settings.html">App Settings</a>
                <a class="nav-link" href="#" id="mobileLogout">Logout</a>
            </div>
        </div>
    </div>

    <div class="app">
        <!-- Desktop Sidebar -->
        <aside class="sidebar">
            <div class="nav-group">
                <a class="nav-link" href="/index.html">Dashboard</a>
                <a class="nav-link active" href="/tenants.html">Tenants</a>
                <a class="nav-link" href="/rent.html">Rent</a>
                <a class="nav-link" href="/utilities.html">Utilities</a>
                <a class="nav-link" href="/payments.html">Payments</a>
                <a class="nav-link" href="/ledger.html">General Ledger</a>
                <a class="nav-link" href="/tenant-ledger.html">Tenant Ledger</a>
                <a class="nav-link" href="/profile.html">My Profile</a>
            </div>
            <div class="nav-group">
                <a class="nav-link" href="/settings.html">App Settings</a>
                <a class="nav-link" href="#" id="logoutBtn">Logout</a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <div class="container">
                <div class="page-header">
                    <h1>Tenants</h1>
                    <button id="openAddModal" class="btn-primary">+ Add Tenant</button>
                </div>

                <!-- CORRECTED FILTER SECTION: Missing </div> tag has been added -->
                <div class="card filter-section">
                    <div style="margin-bottom:12px;">
                        <label style="font-size:0.85rem;font-weight:600;">Filter Tenant By Status</label>
                        <select id="statusFilter">
                            <option value="all">Show All</option>
                            <option value="Active">Active</option>
                            <option value="Moved Out">Moved Out</option>
                            <option value="Left Without Notice">Left Without Notice</option>
                        </select>
                    </div> <!-- THIS WAS THE MISSING TAG -->
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tenant Name</th><th>Status</th><th>Monthly Rent</th><th>Due Day</th><th>Utilities</th><th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tenantTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Tenant Modal -->
    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <h2>Add Tenant</h2>
            <label>Tenant Name</label><input id="addTenantName" type="text">
            <label>Monthly Rent</label><input id="addMonthlyRent" type="number">
            <label>Rent Due Day</label><input id="addRentDueDay" type="number" min="1" max="31">
            <label>Utilities</label>
            <div class="checkbox-group" id="addUtilities">
                <label><input type="checkbox" value="Electric"> Electric</label>
                <label><input type="checkbox" value="Water"> Water</label>
                <label><input type="checkbox" value="Wi-Fi"> Wi-Fi</label>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" data-close="addModal">Cancel</button>
                <button class="btn-primary" id="submitAdd">Save</button>
            </div>
        </div>
    </div>

    <!-- Edit Tenant Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <h2>Edit Tenant</h2>
            <input type="hidden" id="editTenantId">
            <label>Tenant Name</label><input id="editTenantName" type="text">
            <label>Monthly Rent</label><input id="editMonthlyRent" type="number">
            <label>Rent Due Day</label><input id="editRentDueDay" type="number" min="1" max="31">
            <label>Utilities</label>
            <div class="checkbox-group" id="editUtilities">
                <label><input type="checkbox" value="Electric"> Electric</label>
                <label><input type="checkbox" value="Water"> Water</label>
                <label><input type="checkbox" value="Wi-Fi"> Wi-Fi</label>
            </div>
            <label>Tenant Status</label>
            <select id="editTenantStatus">
                <option value="Active">Active</option>
                <option value="Moved Out">Moved Out</option>
                <option value="Left Without Notice">Left Without Notice</option>
            </select>
            <div id="movedOutDateWrap" style="display:none;"><label>Moved Out Date</label><input type="date" id="editMovedOutDate"></div>
            <div id="lastSeenDateWrap" style="display:none;"><label>Last Seen Date</label><input type="date" id="editLastSeenDate"></div>
            <div class="modal-actions" style="justify-content: space-between;">
                <button class="btn-delete" id="deleteTenantBtn">Delete Tenant</button>
                <div style="display:flex; gap:8px;">
                    <button class="btn-secondary" data-close="editModal">Cancel</button>
                    <button class="btn-primary" id="submitEdit">Update</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="./scripts/tenants.js"></script>
    <script src="./scripts/ui.js"></script>
</body>
</html>
